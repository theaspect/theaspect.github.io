---
layout: post
title: Статистика владения кодом
date: '2013-11-17T05:53:00.002+07:00'
author: Constantine Linnick
tags:
- open source
- работа
- контроль версий
- development
modified_time: '2014-04-10T15:47:19.657+07:00'
thumbnail: http://1.bp.blogspot.com/-WSbjNYoWfIw/UofsqT-0bTI/AAAAAAAACKo/DMEjYDsmhVc/s72-c/graph.png
blogger_id: tag:blogger.com,1999:blog-372595778394672936.post-4342415131034448842
blogger_orig_url: http://blog.blzr.me/2013/11/blog-post_17.html
---

<div dir="ltr" style="text-align: left;" trbidi="on"><a href="http://blog.blzr.me/2012/10/blog-post_13.html">Давно</a> была идея визуализировать <i>impact</i> человека на продукт. Мощные визуализаторы типа <a href="http://code.google.com/p/codeswarm/">codeswarm</a> (активность и совместная работа) и <a href="http://code.google.com/p/gource/">gource</a> (процесс работы) показывали не совсем то, что хотелось - текущее состояние. При помощи <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">hg log -u username -p | grep "^+" | wc -l</span>&nbsp; можно посчитать добавления и удаления, но опять же в динамике не увидеть. Хотелось увидеть как росла доля пришедшего человека, насколько быстро она затухала с уходом и какое наследие осталось.<br /><br />Сначала я полез курить физические движки типа <a href="http://box2d.org/">box2d</a>, но какой-то он был скучный и неинтересный - хотелось получить результат за один день. Пришлось отказаться от физического моделирования и вывести данные для простой временноОй диаграммы с накоплением.<br /><br />Полез курить <a href="http://mercurial.selenic.com/wiki/MercurialApi">Mercurial API</a>, заодно накидал ссылок в вики-статью и скачал бесплатный PyCharm. На проект не тянет, поэтому сохранил в <a href="https://gist.github.com/theaspect/7501533">gist</a> (derived work требует назначить лицензию GPL). Программа последовательно в каждой ревизии аннотирует текстовые файлы и считает, количество строк для каждого коммитера. Тестировал на маленьком репозитории, и не заметил нескольких улучшений. Пока работал на нашем основном - успел внести несколько правок.<br /><h4 style="text-align: left;">Процесс запуска</h4><div style="text-align: left;">1. Запускаем первый раз <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">python participation.py</span> - у нас появится шаблон конфига</div><div style="text-align: left;">2. Отключаем подсчет <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">calculate=false</span> и прописываем репозиторий<span style="font-family: &quot;Courier New&quot;,Courier,monospace;"> repo=~/path/to/repo</span></div><div style="text-align: left;">3. Запускам еще раз и получаем на выходе пользователей</div>4. Прописываем им алиасы в разделе <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">[Alias]</span> - часто один пользователь попадает под разными именами, а мы не хотим портить статистику<br />5. Наконец включаем подсчет и запускаем<br />6. Ждем результат, открываем в Excel и рисуем график<br /><h4 style="text-align: left;"><a href="http://1.bp.blogspot.com/-WSbjNYoWfIw/UofsqT-0bTI/AAAAAAAACKo/DMEjYDsmhVc/s1600/graph.png" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" height="188" src="http://1.bp.blogspot.com/-WSbjNYoWfIw/UofsqT-0bTI/AAAAAAAACKo/DMEjYDsmhVc/s640/graph.png" width="640" /></a> </h4><h4 style="text-align: left;">Статистика</h4>На серьезных репозиториях работает <b>ОЧЕНЬ</b> долго.<br />Проанализировано 164.564.370 строк в 1135 коммитах (только ветка default) за 8 часов на Atom N550, потребление памяти в пике 75мб, диск был SSD, но IO был неизмеримо мал.<br /><br />График очень резкий, поскольку разработка зачастую ведется в отдельных ветках, а мощный рефакторинг не сохранял исходного владльца файлов март 2012 (хехе, прямо война правок).</div>