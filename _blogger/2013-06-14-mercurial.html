---
layout: post
title: Markdown в репозитории и оформление веб-интерфейса Mercurial
date: '2013-06-15T00:57:00.001+07:00'
author: Constantine Linnick
tags:
- open source
- контроль версий
- development
modified_time: '2014-04-10T15:47:19.623+07:00'
thumbnail: http://2.bp.blogspot.com/-MQgroQnLy2k/UbtWbvpI6ZI/AAAAAAAAB80/_a_oMZHjUbo/s72-c/themes.png
blogger_id: tag:blogger.com,1999:blog-372595778394672936.post-1531794575121944732
blogger_orig_url: http://blog.blzr.me/2013/06/mercurial.html
---

<div dir="ltr" style="text-align: left;" trbidi="on"><div style="text-align: left;">В мае появилась задача подумать над хранением документации. Где мы только не пытались хранить документацию: и в Dropbox, и в Google Docs. Последнее, где мы остановились, это - Confluence. Совершенно наркоманская система редактирования, потребовалось ставить отдельный плагин, чтобы можно было редактировать чистый HTML. Главная проблема всех этих подходов - рассинхронизация. Документация не соответсвует коду. На втором месте - невозможность автоматической генерации документации в процессе сборки проекта. От системы документации не требуется многого: вставка изображений и кросс-ссылки - более чем достаточно.&nbsp;</div><div style="text-align: left;"><br /></div><div style="text-align: left;">Все <a href="http://blog.blzr.me/2012/02/hardest-piece-of-code-i-ever-wrote.html">серьезные</a> проекты хранят документацию в коде. Концепция <a href="http://blog.blzr.me/2012/04/technorapture-and-readers.html">портабельного билда</a>: клонировав репозиторий, пользователь должен получить абсолютно всё, что нужно для сборки проекта, и, желательно, в текстовом формате, чтобы не пришлось ставить никакого дополнительного софта для редактирования.</div><h4 style="text-align: left;">Mercurial + Markdown</h4>Хотя README встречались и раньше, а wiki хранилась в репозитории еще на <a href="http://code.google.com/p/support/source/browse/wiki/WikiFAQ.wiki">Google Code</a>, но именно с приходом GitHub <a href="https://github.com/github/markup">README.md</a> стало обязательным требованием. Краткое описание проекта, в wiki-стайл разметке <a href="http://daringfireball.net/projects/markdown/syntax">markdown</a>. После знакомства с возможностями этой системы на <a href="http://github.io/">github.io</a> любые сомнения в возможностях разметки пропадают. Приятным бонусом является <a href="http://plugins.jetbrains.com/plugin?pluginId=5970">плагин</a> для IntelliJ IDEA.<br /><br />Очень хотелось получить это на локальном репозитории. Поиск вывел на относительно молодой проект (не первый раз ищу) <a href="https://bitbucket.org/celdredge/hgext.markdown/overview">hgext.markdown</a> от Chris Eldredge. Плагин для mercurial, покрывающий требования к встроенной системе документации на 100%. Когда я его поставил, выснилось, что разметка применяется только к readme, плагин не умеет работать с кодировками (пришлось вспомнить эпичнейший <a href="http://www.youtube.com/watch?v=cecJ9o5GGmw">доклад</a> про кодировки), с картинками (необходимое требование), ну и несколько проблем шаблонами вообще и с разметкой в частности.<br /><h4 style="text-align: left;">Pull request or GTFO </h4><a href="http://voobschem.ru/">В общем</a> все это я пофиксил и заслал Крису толстенный <a href="https://bitbucket.org/celdredge/hgext.markdown/pull-request/2/add-url-rebase-of-images-in-files/commits">пуллреквест</a>, пару дней назад он принял его. Линуксоиды могут спокойно качать плагин, виндузятники в пролёте, поскольку требуется <a href="https://pypi.python.org/pypi/Markdown">библиотека</a> а у mercurial встроенный python, и как подсунуть одно в другое, еще не разбирался. Как выкурю - зашлю еще один пуллреквест с инструкцией.<br /><br />Пока ждал - пошел на IRC канал, чтобы найти кого-нибудь с правами на запись в <a href="http://mercurial.selenic.com/wiki/UsingExtensions">wiki-страницу</a> со списокм плагинов. Оказалось, что особых прав не нужно и достаточно зарегистрироваться (порадовала каптча, которая требует ответить на вопрос про команды mercurial). Вооружившись <a href="http://mercurial.selenic.com/wiki/PublishingExtensions">руководством</a>, создал по фэн-шую <a href="http://mercurial.selenic.com/wiki/MarkdownExtension">страничку</a> плагина.<br /><h4 style="text-align: left;">Темы для mercurial</h4>В процессе ковыряния плагина набрел на встроенную систему <a href="http://mercurial.selenic.com/wiki/Theming">шаблонов</a> и <a href="http://mercurial.selenic.com/wiki/AvailableThemes">тем</a> для hgweb. Внутри крайне разухабистый движок, с доступом ко внутреннему API, позволяющий изобразить решительно всё. Заскриншотил каждую тему и добавил на страницу со списком, чтобы было понятно как каждая выглядит. Кстати, сам mercurial размазан по файловой системе: бинарники лежат в <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">/usr/share/mercurial/templates</span>, а основной код в <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">/usr/lib/python2.7/dist-packages/mercurial</span>.<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-MQgroQnLy2k/UbtWbvpI6ZI/AAAAAAAAB80/_a_oMZHjUbo/s1600/themes.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="http://2.bp.blogspot.com/-MQgroQnLy2k/UbtWbvpI6ZI/AAAAAAAAB80/_a_oMZHjUbo/s1600/themes.png" height="281" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Пять стандартных тем и Markdown, идущий в комплекте с плагином</td></tr></tbody></table><br /></div>