---
layout: post
title: Пол года с Groovy и Grails
date: '2014-12-13T22:37:00.000+06:00'
author: Constantine Linnick
tags:
- боль
- работа
- orm
- development
modified_time: '2014-12-14T15:35:01.711+06:00'
blogger_id: tag:blogger.com,1999:blog-372595778394672936.post-4793552997620765464
blogger_orig_url: http://blog.blzr.me/2014/12/groovy-grails.html
---

<div dir="ltr" style="text-align: left;" trbidi="on"><a href="https://pbs.twimg.com/media/Bt8NEveIcAEsTqH.png" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" height="400" src="https://pbs.twimg.com/media/Bt8NEveIcAEsTqH.png" width="241" /></a>Пол года уже как пишу на <a href="http://groovy.codehaus.org/">Groovy</a>/<a href="https://grails.org/">Grails</a> и пора бы уже сформулировать отношение к этим вещам в письменном виде. Сравнивать буду, естественно, с Python/<a href="https://www.djangoproject.com/">Django</a>. Совсем немного пощупал <a href="http://www.cherrypy.org/">cherrypy</a>/<a href="http://jinja.pocoo.org/">jinja</a> когда готовил олимпиаду для студентов, но они не сильно отличаются.<br />TL;DR версия: groovy восхитителен, джависты, для мелких тасков крутейшая штука, берите и используйте, grails не нравится потому, что рвет <a href="http://blog.blzr.me/2014/02/blog-post_12.html">связность</a> кода, особенно заметно на больших масштабах и совершенно немодульный.<br /><br />Дальше будет описание отдельных аспектов и иногда сравнение.<br /><a name='more'></a><br /><br /><h4 style="text-align: left;">Пакетность</h4><div style="text-align: left;">Как бы ни ругали монструозные скрипты Maven, Apache Foundation родил нечто крутое: <a href="http://repo1.maven.org/">repo1.maven.org</a>. Совершенно простой и открытый репозиторий, который можно спокойно отзеркалить, в который можно залить свои либы - стал стандартом де-факто, базовой частью остальных пакетных менеджеров.</div><div style="text-align: left;"><br /></div><div style="text-align: left;">Groovy пошел еще дальше: пакетный менеджер встроенный прямо в язык - <a href="http://groovy.codehaus.org/Grape">grape</a>. Пишешь перед импортами <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">@Grab(group='org.springframework', module='spring', version='2.5.6')</span> и либа скачивается. Волшебство и никакой магии, прямо как я люблю.</div><div style="text-align: left;"><br /></div><div style="text-align: left;">Джавовые библиотеки в целом гораздо богаче аналогов чем в pypi, хотя бы в силу большей распространенности java. </div><div style="text-align: left;"><br /></div><div style="text-align: left;">В python нужно использовать сторонний менеджер, в 3.4 наконец то <a href="https://www.python.org/dev/peps/pep-0453/">вкрутили</a> pip из коробки. Но до аналога @Grab логичный шаг еще не сделан.</div><h4 style="text-align: left;">Функциональщина и DSL</h4><div style="text-align: left;">По поводу бесшовного мигрирования с java: представьте, что <a href="http://projectlombok.org/">lombok</a> и <a href="https://github.com/google/guava">guava</a> уже встроены в язык - уже одного этого достаточно для миграции Но есть еще <a href="http://groovy.codehaus.org/Differences+from+Java">мешок</a> <a href="http://groovy.codehaus.org/Groovy+style+and+language+feature+guidelines+for+Java+developers">сахара</a>.&nbsp; Функциональный стиль написания кода становится легким и непринужденным - то что только начинают осваивать в java-8 мире. Необязательность ";", "()" и "return", синтаксическое описание списков и мапов, опциональная типизация, safe-navigation и elvis-operator, ненужные геттеры-сеттеры, красивый синтаксис при использовании closure в качестве аргумента, дающий богатые возможности по написанию DSL - это стало must-have инструментами.</div><div style="text-align: left;"><br /></div><div style="text-align: left;">Вообще, все в groovy пронизано идеей <a href="http://groovy.codehaus.org/Writing+Domain-Specific+Languages">DSL</a>, начиная от упрощенного синтаксиса (все-же победнее чем в ruby), до доступа к <a href="http://groovy.codehaus.org/Compile-time+Metaprogramming+-+AST+Transformations">AST</a>. Все это позволяет создавать человеко-читаемые конфиги, которые на самом деле являются исполняемым кодом на groovy. Под человеком я имею ввиду бизнес-аналитика уровня "могу написать простенький селект с фильтрацией". Когда такой человек начинает читать и успешно править DSL-код - это говорит о многом. DSL эта такая фича, после освоения которой будешь спрашивать себя: как я жил без этого раньше.</div><h4 style="text-align: left;">Грельсы</h4><div style="text-align: left;">Grails - full-stack framework, как они пишут про себя и именно это является проблемой. Для небольшого проекта convention over configuration это отличная идея, резко сокращает объем написания boilerplate кода. маленькому проекту грельсы будут как из пушки по воробьям. А вот в большом проекте начинаются те самые проблемы, за которые ругают maven. Как только пытаешься свернуть с проторенной дорожки, начинаются непролазные дебри. А это неизбежно придется сделать, что-то серьезное неизбежно потребует нестандартных решений: что-то подменить, что-то допилить, где-то изменить логику.&nbsp;</div><div style="text-align: left;"><br /></div><div style="text-align: left;">Вот тут-то и начинаются проблемы: очень тяжело ковырять full-stack, его приходится постоянно таскать с собой даже если тебе не нужна web-часть. То, за что мне так нравилась java, идеология модульности, здесь заменили на огромную spring-кувалду, которой ты вынужден забивать сваи, и гвозди, и шурупы - вообще все что видишь вокруг.</div><div style="text-align: left;"><br /></div><div style="text-align: left;">Я скучаю по <a href="https://github.com/google/guice">guice</a>, по его простоте и элегантности. Pivotal действительно стоит подумать о модульности (ведь даже spring модульный, по крайней мере был, когда я на него смотрел). Чтобы можно было разбить доменную модель, сервисный слой, веб-часть</div><h4 style="text-align: left;">ORM</h4><div style="text-align: left;">Разработчики доабстрагировались до маразма и грельсовый <a href="http://grails.org/doc/latest/guide/GORM.html">GORM</a> настолько неинтуитивен и далек от SQL, что им совершенно невозможно пользоваться без открытой документации в мало-мальски нетривиальных ситуациях (а они обязательно будут, см выше). Маппинг объектов мне тоже не нравится, поскольку, тоже разрывает связанность: вместо задания аннотациями атрибутов у отдельных полей, все собрано в кучу, крайне error-prone. И когда тебе нужно замапить объект приходится идти в документацию, потому что запомнить это совершенно невозможно. Сон разума породил чудовище или тяжелые наркотики, я не знаю. Хотя тривиальные CRUD случаи - абсолютно не требуют мозговых усилий.</div><h4 style="text-align: left;">Layout</h4><div style="text-align: left;"><a href="http://grails.org/doc/latest/guide/gettingStarted.html#conventionOverConfiguration">Идеология</a>, положенная в структуру проекта "давайте скинем в отдельную кучу view, в другую кучу controller, в третью service, а в четвертую - domain" - абсолютно порочна. В подавляющем большинстве случаев на один view приходится один контроллер и один сервис. Все это должно быть объединено в один логический модуль и лежать рядом. Они связаны между собой by-desing, и раскидать их по трем кучкам означат разорвать код. На предыдущем проекте, только спустя два года стало понятно, что организовывать код по слоям очень плохая идея и мы потихоньку начали организовывать его в модули.</div><div style="text-align: left;"><br /></div><div style="text-align: left;">Еще одна очень плохая идея - в функцию <a href="http://grails.org/doc/latest/ref/Tags/render.html">render</a> передаем <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">viewname</span>, который будет искаться с таким же путем как у контроллера, но в папке view по имени <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">_viewname.gsp</span> чтозанах? Это нихера не очевидно, это магия, а я ненавижу хреновых волшебников. Когда я первый раз столкнулся с этим, и обнаружил это зарывшись глубоко в исходники фреймворка, удивлению моему не было предела. Нельзя разрывать имя темплейта и физический путь, тем более ценой каких-то четырех символов.</div><h4 style="text-align: left;">Итог</h4><div style="text-align: left;">Напрашивается закономерный вывод: хитрожопые Pivotal заманивают в свои сети простотой начала проекта, который бегло вырастает до среднего размера, но дальше обязательно появятся проблемы, на них которых неплохо заработать консультированием. Вообще как могут давать "High-level design overview and best practices" люди, которые постоянно нарушают связность кода? - Я сомневаюсь что они используют в реальной практике свое детище.</div></div>