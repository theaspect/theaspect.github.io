---
layout: post
title: Дао версионности
date: '2013-04-15T22:09:00.000+07:00'
author: Constantine Linnick
tags:
- боль
- контроль версий
- development
modified_time: '2014-04-10T15:47:19.721+07:00'
thumbnail: http://2.bp.blogspot.com/-DyWffppZ5UA/UWwI7b6PNlI/AAAAAAAABzA/og9wtPrfO0c/s72-c/svn.png
blogger_id: tag:blogger.com,1999:blog-372595778394672936.post-8333483147952077161
blogger_orig_url: http://blog.blzr.me/2013/04/blog-post.html
---

<div dir="ltr" style="text-align: left;" trbidi="on"><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-DyWffppZ5UA/UWwI7b6PNlI/AAAAAAAABzA/og9wtPrfO0c/s1600/svn.png" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" height="300" src="http://2.bp.blogspot.com/-DyWffppZ5UA/UWwI7b6PNlI/AAAAAAAABzA/og9wtPrfO0c/s1600/svn.png" width="320" /></a></div><h4 style="text-align: left;">Предыстория </h4>На третьем курсе зав.каф. Захаров Ю.Н. отправил меня помогать старшекурснику в написании визуализатора треков частиц. С меня было программирование, со старшекурсника математическое обеспечение. В тот момент у меня откуда-то появилось знание (возможно с хабра), что Ъ-пацаны в командной работе юзают контроль версий. State-of-the-art на тот момент был subversion, mercurial с git, хоть и родились но пугали кучей проблем (возможно отталкивало отсутствие опыта). Я заинитил репозиторий, выдернул из меркуриала консольные утилиты и начал его юзать. Использовал в одиночку, хоть и не долго.<br /><br /><a name='more'></a><br /><br />В это же время устроился на работу, где было сложно с программистами и царил первобытный хаос. Спустя несколько месяцев появился DBA и еще один разработчик. И мы успешно занимались разработкой в течении почти двух лет, без проблем мерджа изменения при помощи TotalCommander. Все изменилось 22 марта 2010 года. За неделю до этого появился третий программист и сложность мерджа резко возросла. После недели кошмара и непрерывного решения конфликтов, новичок сказал: хватит это терпеть, давайте заюзаем svn, что мы и сделали, успешно перенеся всю разработку под контроль версий и подняв trac, который легко интегрировался с svn.<br /><h4 style="text-align: left;">Свет в конце тоннеля</h4>21 ноября 2010 года у нас стартанул минипроект. На нем мы решили попробовать распределенную систему контроля версий. Выбор пал на mercurial. Распределенности там никакой не получилась, поскольку проект тихо умер спустя две недели так и не дожив до мерджа на 13 коммите. Больше всего привелекло в нем отсутствие необходимости в централизованном сервере, а hg serve казалась пределом мечтаний. С тех пор я использую исключительно mercurial, git, который попробовал использовать для собственного мини-проекта, так и не взлетел. Особенно убило монструозная установка, приносящая на винду всю командную оболочку линукса, плюс танцы с ssh-ключом привили стойкое отвращение.<br /><h4 style="text-align: left;">0 этап</h4><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-ALGJe5AQj80/UWwO17BGCbI/AAAAAAAABzQ/SaL7acAgjaU/s1600/mirit.png" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" height="93" src="http://2.bp.blogspot.com/-ALGJe5AQj80/UWwO17BGCbI/AAAAAAAABzQ/SaL7acAgjaU/s1600/mirit.png" width="320" /></a></div>На новой работе я сразу начал с hg init и проекта в bitbucket, который хоть и не был так наворочен, как github, но позволял создавать приватные репозитории для маленьких команд. Более-менее начал даже использовать ветки. Тем не менее, одиночная разработка не сильно отличалась от работы с централизованным репозиторием в небольшой команде.<br /><h4 style="text-align: left;">1 этап</h4><table cellpadding="0" cellspacing="0" class="tr-caption-container" style="float: right; margin-left: 1em; text-align: right;"><tbody><tr><td style="text-align: center;"><a href="http://1.bp.blogspot.com/-9Y754gxZsVA/UWwQmF1sRHI/AAAAAAAABzc/9UnLvaxYK04/s1600/hg2.png" imageanchor="1" style="clear: right; margin-bottom: 1em; margin-left: auto; margin-right: auto;"><img border="0" height="102" src="http://1.bp.blogspot.com/-9Y754gxZsVA/UWwQmF1sRHI/AAAAAAAABzc/9UnLvaxYK04/s1600/hg2.png" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Горыныч</td></tr></tbody></table>Еще раз сменив работу, я попал четвертым в команду в самый разгар кодинга. У нас был центральный репозиторий, через который шел обмен ревизиями. Многоголовая разработка в одной ветке, постоянные мерджи и конфликты с взаимо-исключающими изменениями - все это не могло длиться долго. Соседи тоже использовали mercurial, но мы так и не смогли объяснить что мы хотим получить, а используемые ими инструменты (например collapse) нам не хотелось применять. Понять как правильно работать с rebase мы тогда не смогли.<br /><h4 style="text-align: left;">2 этап</h4><table cellpadding="0" cellspacing="0" class="tr-caption-container" style="float: right; text-align: right;"><tbody><tr><td style="text-align: center;"><a href="http://s01.developerslife.ru/public/images/gifs/beb52ecb-0806-4775-985e-269c7a775d2d.gif" imageanchor="1" style="clear: right; margin-bottom: 1em; margin-left: auto; margin-right: auto;"><img border="0" height="180" src="http://s01.developerslife.ru/public/images/gifs/beb52ecb-0806-4775-985e-269c7a775d2d.gif" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Мердж без единого конфликта</td></tr></tbody></table>Вскоре терпение лопнуло и каждый разбежался по своим веткам, доверив разовый мердж, по завершению задачи, тимлиду. История сразу же выпрямилась, исчезли регулярные мерджи недописанного кода. С требованием вливать в главную ветку только работающий код - default сразу стал стабильно рабочим. Тем не менее понимание стабилизации кода и итераций в разработке еще не было.<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://nvie.com/img/2009/12/Screen-shot-2009-12-24-at-11.32.03.png" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" height="320" src="http://nvie.com/img/2009/12/Screen-shot-2009-12-24-at-11.32.03.png" width="239" /></a></div><h4 style="text-align: left;">3 этап</h4><div style="text-align: left;">Посетив кодефест 2012, мы <a href="http://blog.blzr.me/2012/03/git-flow.html">услышали</a> про GitFlow, который просто перевернул понимание командной работы над серьезным, долгоживущим проектом. Мы сразу адаптировали его под наши меркуриальные реалии и стали активно использовать. Столкнулись с одной единственной проблемой: массовое закрытие веток-фич - но это тема отдельного разговора.</div><h4 style="text-align: left;">4 этап</h4><div style="text-align: left;">Не так давно обратил внимание, что открывать ветки под микрофиксы лениво, да и вообще наконец разобрались экстеншеном rebase, что позволило вести разработку в одной ветке-фиче, не порождая Горыныча и не плодя ненужных веток. Достаточно было только одного требования: последний коммит ребейза должен быть рабочим, чтобы не ломать коллегам код, когда они спулят из центрального репозитория.</div><div style="text-align: center;"><b><a href="http://blog.blzr.me/2013/04/blog-post_20.html">Продолжение</a> <a href="http://blog.blzr.me/2013/04/blog-post_21.html">следует</a></b><br /><div style="text-align: left;"><b>&nbsp;</b></div><div style="text-align: left;"><b>P.S. </b>Rebase подробно обсуждается в radio-t <a href="http://www.radio-t.com/p/2013/03/02/podcast-330/">#330</a> и <a href="http://www.radio-t.com/p/2013/05/04/podcast-339/">#339</a><b><br /></b></div></div></div>