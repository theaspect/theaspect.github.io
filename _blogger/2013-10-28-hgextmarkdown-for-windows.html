---
layout: post
title: Hgext.markdown for Windows
date: '2013-10-28T23:10:00.000+07:00'
author: Constantine Linnick
tags:
- open source
- работа
- контроль версий
- development
modified_time: '2014-04-10T15:47:19.745+07:00'
thumbnail: http://4.bp.blogspot.com/-rDkIIFZ3D64/Um6JjJCc8UI/AAAAAAAACJ4/vhuR2N7qVeU/s72-c/compare.png
blogger_id: tag:blogger.com,1999:blog-372595778394672936.post-8930095998059127599
blogger_orig_url: http://blog.blzr.me/2013/10/hgextmarkdown-for-windows.html
---

<div dir="ltr" style="text-align: left;" trbidi="on"><h4 style="text-align: left;">Python eggs </h4>Main problem with this extension on Windows OS was external dependency <a href="https://pypi.python.org/pypi/Markdown/2.3.1">Markdown</a> and unlike on Ubuntu you cannot execute <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">apt-get python-markdown</span> in your shell. TortoiseHG has bundled python and you cannot simply add egg inside dist-packages. I look at source and find out, that original way for Windows user was uncomment and edit line <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">sys.path.append("c:/python27/Lib/site-packages/markdown-2.2.0-py2.7.egg")<span style="font-family: inherit;"></span></span> but nothing was in documentation about it.<br /><br />So I decide to rewrite this mechanism in fallback style: first we try to load markdown package and if failed, lookup using path from config (python can transparently lookup files in zip archives):<br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">try: <br />&nbsp;&nbsp;&nbsp; from markdown import Markdown&nbsp;</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">except ImportError:<br />&nbsp;&nbsp;&nbsp; dir = os.path.dirname(os.path.realpath(__file__)) <br />&nbsp;&nbsp;&nbsp; md = ui.config("web", "markdown.egg", "Markdown-2.3.1") <br />&nbsp;&nbsp;&nbsp; ui.debug("Markdown not found search for egg in local dir %s for %s.zip\n" % (dir, md)) <br />&nbsp;&nbsp;&nbsp; sys.path.append(os.path.join(dir, "%s.zip\%s" % (md, md))) <br />&nbsp;&nbsp;&nbsp; try: <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; from markdown import Markdown <br />&nbsp;&nbsp;&nbsp; except ImportError: <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ui.error("Unable to locate markdown in path %s" % sys.path) <br />global Markdown</span><br /><br />this is final version corrected by Chris E<span>ldredge. Now you can download markdown package and put it in extension folder.</span><br /><h4 style="text-align: left;"><span>Relative paths</span></h4><table cellpadding="0" cellspacing="0" class="tr-caption-container" style="float: right; margin-left: 1em; text-align: right;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-rDkIIFZ3D64/Um6JjJCc8UI/AAAAAAAACJ4/vhuR2N7qVeU/s1600/compare.png" imageanchor="1" style="clear: right; margin-bottom: 1em; margin-left: auto; margin-right: auto;"><img border="0" height="228" src="http://4.bp.blogspot.com/-rDkIIFZ3D64/Um6JjJCc8UI/AAAAAAAACJ4/vhuR2N7qVeU/s320/compare.png" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Rendering comparison<br />BitBucket vs hgext.markdown</td><td class="tr-caption" style="text-align: center;"><br /></td></tr></tbody></table><span>Second big improvement is relative paths in markdown files. We massively use crossreferences in the <a href="http://blog.blzr.me/2013/06/mercurial.html">docs</a> we store in our repository, and quickly find out some problems with relative links in which used parent (..) directory and hash (#). I fixed this and update demo page with picture and relative navigation. Unfortunately BitBucket incorrectly render this markdown because of the <a href="https://bitbucket.org/site/master/issue/6315/relative-urls-in-readmemd-files-only-work">bug</a>.</span><br /><h4 style="text-align: left;"><span>Preview</span></h4><span>Also now you can navigate to preview of uncommited files with one click in menu. Not a big deal but usability improvement.</span><br /><h4 style="text-align: left;"><span>Summary</span></h4><span>Chris already merged this patches to his repo. So if you want to see beautiful doc instead of raw markdown, even on Windows it is good time to install or update <a href="https://bitbucket.org/celdredge/hgext.markdown/">extension</a>.</span></div>