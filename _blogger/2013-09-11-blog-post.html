---
layout: post
title: Костыли, протухший код, трагедия общин и устаревшие технологии
date: '2013-09-12T00:12:00.003+07:00'
author: Constantine Linnick
tags:
- боль
- мысли
- работа
- development
modified_time: '2014-04-10T15:47:19.731+07:00'
blogger_id: tag:blogger.com,1999:blog-372595778394672936.post-846891520170217811
blogger_orig_url: http://blog.blzr.me/2013/09/blog-post.html
---

<div dir="ltr" style="text-align: left;" trbidi="on"><div style="text-align: right;">"там есть довольно элегантный костыль,</div><div style="text-align: right;">я бы сказал, <a href="https://twitter.com/kzaikin/status/352349042052837376">трость</a>"</div><h3 style="text-align: left;">Поток созания</h3><h4 style="text-align: left;">Костылинг</h4><table cellpadding="0" cellspacing="0" class="tr-caption-container" style="float: right; margin-left: 1em; text-align: right;"><tbody><tr><td style="text-align: center;"><a href="http://s1.developerslife.ru/public/images/gifs/a38e12c0-8178-4618-8e06-cc3351eeb189.gif" imageanchor="1" style="clear: right; margin-bottom: 1em; margin-left: auto; margin-right: auto;"><img border="0" height="158" src="http://s1.developerslife.ru/public/images/gifs/a38e12c0-8178-4618-8e06-cc3351eeb189.gif" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;"><a href="http://developerslife.ru/12"><span class="value">Когда я возвращаюсь к разработке своего кода, <br />который я не комментировал</span></a></td></tr></tbody></table><div style="text-align: left;">Бывает, решаешь какую-то проблему, копаешь вглубь и находишь костыль (в том числе собственный) быстро решающий какую-то локальную проблему, но вносящую еще несколько в других местах. Каждый раз смотрю и думаю, что же мешало решить проблему, ведь это очевидно. Это как темная комната и светлая улица: видно только с одной стороны.</div><h4 style="text-align: left;"><a name='more'></a>Грешновато</h4><div style="text-align: left;">Первая проблема от недостатка опыта, информации, внимания. Но бывает мы идем на осознанное преступление. Мы делаем <a href="http://blog.blzr.me/2012/12/blog-post_26.html">допущение</a>, аккуратно его описываем и выделяем ярко <a href="http://blog.jetbrains.com/idea/2006/07/customizing-todo-filters/">оранжевыми</a> FIXME/TODO. Но бывает что такая же проблема всплывает где-то ещё - костыль аккуратно копируется вместе с все тем же оранжевым описанием. В этом месте нужно резко остановиться. Ни в коем случае нельзя умножать один и тот же костыль - его нужно срочно инкапсулировать, старый вариант удалить или пометить аннотацией deprecated, в комменте написать правильный путь, а внутри бросать exception и запись в лог, чтобы не дай Б-г кто-нибудь не использовал.</div><h4 style="text-align: left;">Code decay</h4><div style="text-align: left;">Отсутствие контроля за качеством кода заметно снижает качество нового кода. Но что делать со старым? Он неизбежно протухает, даже если в него не вносятся изменения: подходы со временем <a href="http://blog.blzr.me/2012/10/blog-post_13.html">меняются</a>. Роберт Мартин в своем "чистом коде" сформулировал очевидную истину: <i>Хорошо написать код недостаточно. Необходимо поддерживать чистоту  кода с течением времени. Все мы видели, как код загнивает и деградирует с  течением времени. Значит, мы должны активно поработать над тем, чтобы  этого не произошло.</i> <i>У бойскаутов существует простое правило, которое применимо и к нашей профессии:</i> <b><i>Оставь место стоянки чище, чем оно было до твоего прихода. </i></b><i>Если  мы все будем оставлять свой код чище, чем он был до нашего прихода, то  код попросту не будет загнивать. Чистка не обязана быть глобальной.  Присвойте более понятное имя переменной, разбейте слишком большую  функцию, устраните одно незначительное повторение, упростите сложную  цепочку условий.</i><br /><i>Представляете себе работу над проектом, код которого <b>улучшается</b> с течением времени? Но может ли профессионал позволить себе нечто иное?  Разве постоянное совершенствование не является неотъемлемой частью  профессионализма? </i>(Кстати, интересное <a href="https://plus.google.com/108967431947412296254/posts/ZaxnrarBvKS">обсуждение</a> этой цитаты).</div><div style="text-align: left;"><br /></div><div style="text-align: left;">Это реально работает: проект можно аккуратно переписать, начав с расчистки <a href="http://forum.ixbt.com/topic.cgi?id=26:40847#18">эпсилон-окрестности</a>, участки кристаллизации в океане хаоса. Именно так произошло с моим первым реальным проектом. Сейчас меня реально начинает корёжить если я встретился с какой-то неочевидной вещью или проблемой и не поставить маркер и комментарий с описанием (почему-то приходит ассоциация с сошедшей лавиной и расстановкой флажков поисковой командой), чтобы потом легко вернуться к решению проблемы и максимально быстро восстановить контекст проблемы.</div><h4 style="text-align: left;">Владение кодом</h4><div style="text-align: left;">Всё это хорошо и красиво, в духе капитана очевидность: мойте руки перед едой и чистите зубы два раза в день. Но не работает в одном простом случае: если у кода нет владельца. Еще коммунисты на практике проверили: общее - значит ничье, значит насрать прям здесь и не надо убирать, пофиг, что через год будешь плавать по уши в дерьме и на простейшие проблемы будет тратиться неимоверное количество времени, а менеджер будет охреневать, что на добавление одного поля в опердень уходит две недели времени, три дня дауна и месяц багофиксинга - технический долг, потом техническая ипотека и вся эта радость закономерно заканчивается техническим дефолтом. Эффект давно известен, как <a href="http://ru.wikipedia.org/wiki/%D0%A2%D1%80%D0%B0%D0%B3%D0%B5%D0%B4%D0%B8%D1%8F_%D0%BE%D0%B1%D1%89%D0%B8%D0%BD">трагедия общин</a>. Ярчайшая иллюстрация - <a href="http://habrahabr.ru/post/183130/">Microsoft</a>.</div><div style="text-align: left;"><br /></div><div style="text-align: left;">Это становится очень заметно, когда каждый стремится решить максимальное количество задач, особенно, если имеются метрики или прямая денежная мотивация. Стандартная фраза: мне платят за решение конкретных задач, а не за чистый код, поэтому я решу задачу максимально просто и быстро: просто скопирую тысячестрочный кусок кода коллеги, который решает похожую задачу и изменю пару строк, затем другой коллега поступит точно так же, и еще раз, и ещё. А затем бизнес-логика изменится, и человек будет менять в одном конкретном месте, даже не задумываясь, что эта проблема в десятке мест не исправлена, а еще десяток мест полагается на исправленный фрагмент. И вот всё поползло и поехало.</div><h4 style="text-align: left;">Устаревшие технологии </h4><div style="text-align: left;">Такое поведение нужно пресекать и всячески избегать. На мой взгляд это наихудшее, что может случиться, потому что яд медленно распространяется и поражает всю команду до полной недееспособности. Поиск шорткатов характерен вообще всем, а не только программистам, вот только можно ли не в коде проводить рефакторинг и расставлять флажки с комментариями?</div><div style="text-align: left;"><br /></div><div style="text-align: left;">Один из примеров - застревание в устаревшей технологии. Когда-то технология идеально решала задачи (быть может до сих пор решает). Но с тех пор индустрия ушла, опять же не обязательно вперед. И вот уже тяжело найти людей на вакантые должности, а мегаLOCи старого кода нужно как-то поддерживать. А расчищать Авгиевы конюшни никому не хочется. Рано или поздно это заканчивается выбрасыванием всего этого богатства и тотальным переписыванием. С астрономическими затратами - кому-то рано или поздно придется платить по долгам.</div></div>