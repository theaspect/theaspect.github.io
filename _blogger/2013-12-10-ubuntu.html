---
layout: post
title: Про Ubuntu и клиническую смерь панголина
date: '2013-12-11T00:26:00.002+07:00'
author: Constantine Linnick
tags:
- боль
- open source
- работа
modified_time: '2013-12-11T00:30:26.271+07:00'
blogger_id: tag:blogger.com,1999:blog-372595778394672936.post-2362042021228684202
blogger_orig_url: http://blog.blzr.me/2013/12/ubuntu.html
---

<div dir="ltr" style="text-align: left;" trbidi="on"><h4 style="text-align: left;">Про убунту</h4>Убунта (хотя, пожалуй,  это свойственно почти всем дистрибутивам) похожа на лоскутное одеяло,  состоит из кучи софта, разрабатываемого разными людьми. Стандарты?  ЛолШТО? Есть, конечно, <a href="http://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard">FHS</a>,  но всем плевать. Без интернетов под рукой восстановить систему после  нетривиального падения не реально. Куча файлов со своим уникальным  именованием, куча ключиков и параметров.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://i1.kym-cdn.com/photos/images/original/000/398/994/e8d.jpg" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" height="283" src="http://i1.kym-cdn.com/photos/images/original/000/398/994/e8d.jpg" width="320" /></a></div>Самый  эпичный момент был при обновлении до 12.04: из-за проблем с  оборудованием, Космонавты выпилили режим гибернации из-за проблем с  некоторыми версиями материнок. Включается он эпичнейше: не  переключателем (как сделали бы разумные люди), не раскомментированием  строк в каком-нибудь конфиге (как сделали бы разумные, но ленивые люди),  а <a href="http://askubuntu.com/questions/94754/how-to-enable-hibernation/94963#94963">воссозданием</a> конфига. Когда я это прочитал, единственная мысль была: НО? КАК? БЛЯДЬ? Я должен был бы его воспроизвести без интернета???<br /><br />Хотя есть и положительные моменты: нет <a href="http://blog.blzr.me/2013/10/blog-post.html">черного ящика</a> и магии, система состоит из отдельных компонентов, которые кое-как слеплены во что-то цельное <a href="http://devopsreactions.tumblr.com/post/44210497845/visiting-the-guy-that-wrote-the-build-scripts">сумеречными гениями</a>,  компоненты можно вынимать и рассматривать, благо половина - скрипты на  баше и петоне, а для второй половины есть сырцы (хотя тут уже надо  сильно хотеть покопаться), можно вынимать и вставлять другие, иногда  шестеренки заедают и хрустят, потом приходится перебирать весь движок. Самое поразительное здесь <a href="http://en.wikipedia.org/wiki/Fault-tolerance">живучесть</a> - даже деградировав или лишившись многих функций система продолжает работать.<br /><h4 style="text-align: left;"><a name='more'></a>Перипетии</h4>Мое желание, чтобы Ubuntu не терзала меня уведомлениями, а сама <a href="https://help.ubuntu.com/community/AutomaticSecurityUpdates">тихо ставила</a> апдейты, сыграло злую шутку. После месячного аптайма и перезагрузки система жестко залипла. Хард резет и вот, получите битый диск KernelPanic и&nbsp;<span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><complete id="goog_1580173404"></complete>BusyBox v1.18.5 built-in shell (ash)</span>. За каким хреном нужен этот бизибокс, если в нем нет банально fsck, я не понял.<br /><br />Коллега записал загрузочную флешку, я стартанул с неё, проверил жесткий диск. Параллельно выделил на жестком отдельный раздел и зебекапил хоум - так, на всякий случай. Fsck, пока проверял, нашел кучу битых файлов. Стартую, висит экран загрузки, переключаюсь - опа /sbin/mountall не найден.<br /><br />У другого коллеги забираю на той же флешке /bin и /sbin и заливаю себе. Система смогла загрузиться еще дальше - теперь я хотя бы вхожу в консоль. Оке, давай <a href="http://ubuntuforums.org/showthread.php?t=735693">принудительно переустановим</a> все установленные пакеты.<br /><br />Вау, я смог загрузиться в экран логина, но по-прежнему не могу залогиниться - не хватает либ. Переустанавливаю либу, логинюсь, вываливаюсь, смотрю, чего не хватает - повторяю. Наконец залогинился в чистый рабочий стол, а после еще нескольких итераций даже поднял юнити.<br /><br />Каково же было моё удивление, когда я увидел систему месячной давности. Ага, я же сделал бекап. Но там, сука, та же херня. Тут стоит пояснить, что по-умолчанию, при установке, система предлагает все шифровать: и своп, и хоум. Я согласился, но потом быстро передумал: все это сильно тормозило и я избавился (как я думал) от шифрования.<br /><br />Короче, я смирился, и полез приводить хоум месячной давности в приемлимое состояние. Решил зачистить старый шифрованный раздел, захожу и смотрю на подозрительно свежие даты в папке <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">.ecryptfs</span>. Думаю, дай-ка попробую замаунтить это безобразие. В общем с третьей попытки у меня <a href="https://help.ubuntu.com/community/EncryptedPrivateDirectory">удалось</a>. И даже не понадобилась passphrase, хватило обычного логина.<br /><br />Оказалось, что ecryptfs после старта автоматически разворачивается поверх хоума и начинает прозрачно записывать всё в свои директории. В итоге убунта восстановилась до близкого к исходному состоянию, правда периодически сыпет ошибками - не все еще либы восстановлены. Не выжила только FileZilla наотрез отказавшись запускаться.</div>