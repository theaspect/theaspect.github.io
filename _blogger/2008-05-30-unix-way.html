---
layout: post
title: UNIX way
date: '2008-05-30T21:26:00.000+07:00'
author: Constantine Linnick
tags:
- lytdybr
- ретроспектива
- development
modified_time: '2014-04-10T15:46:23.625+07:00'
blogger_id: tag:blogger.com,1999:blog-372595778394672936.post-2189943000125313378
blogger_orig_url: http://blog.blzr.me/2008/05/unix-way.html
---

<div dir="ltr" style="text-align: left;" trbidi="on"><div dir="ltr" style="text-align: left;" trbidi="on">Прошел примерно год, как пришло какое-то понимание пакетных файлов и скриптов вообще. Сейчас уже автоматизировано очень многое. Недавно набрел на интересную разработку <a href="http://unxutils.sourceforge.net/">unxutils</a> (стандартные GNU утилиты, собранные под виндой). Ну и сразу некоторое испытание: написать скриптец,  который будет ежедневно следить за изменениями в некоторой папке и формировать отчет в rss<br /><br /><a name='more'></a><br /><br /><pre class="brush:perl">SET WORKDIR=%TEMP%\watcher<br />SET WATCH=C:\temp\base<br />SET RSS=%WORKDIR%\rss.xml<br /><br />mkdir %WORKDIR%\snapshots\all<br />REM делаем снимок<br />find %WATCH% -ls | gawk -- "{print $11,$7,$10,$8,$9}"  &gt; %WORKDIR%\dir2<br />REM Ищем разницу<br />diff %WORKDIR%\dir1 %WORKDIR%\dir2 | grep "^[\&lt;\&gt;]" | sed s/\\\\/\\/g &gt; %WORKDIR%\snapshots\all\%DATE%<br />del /Q %WORKDIR%\snapshots\*.*<br />REM копируем 10 последних в папку<br />for /f %%f in ('ls %WORKDIR%\snapshots\all ^| tail -n 10') do copy %WORKDIR%\snapshots\all\%%f %WORKDIR%\snapshots\%%f<br /><br />REM Голова rss<br />echo ^&lt;^?xml version=^"1.0^" ^?^&gt; &gt; %RSS%<br />echo ^&lt;rss version="2.0"&gt; &gt;&gt; %RSS%<br />echo ^ &gt;&gt; %RSS%<br />echo ^Matfaq RSS^&lt;/title^&gt;  &gt;&gt; %RSS%<br />echo ^http://mathfaq.somee.com/index.aspx^&lt;/link^&gt;  &gt;&gt; %RSS%<br />echo ^Lenta^&lt;/description^&gt;  &gt;&gt; %RSS%<br />echo ^rus^&lt;/language^&gt;  &gt;&gt; %RSS%<br />echo ^Sun, 24 Sep 2006 15:00:00 GMT^&lt;/pubDate^&gt;  &gt;&gt; %RSS%<br />echo ^Mon, 02 Oct 2006 03:07:01 GMT^&lt;/lastBuildDate^&gt;  &gt;&gt; %RSS%<br />echo ^http://mathfqa.somee.com/rss.aspx^&lt;/docs^&gt;  &gt;&gt; %RSS%<br />echo ^Zheka Generator 0.000000-e10^&lt;/generator^&gt;  &gt;&gt; %RSS%<br />echo ^i@mail.ru^&lt;/managingEditor^&gt;  &gt;&gt; %RSS%<br />echo ^l@mail.ru^&lt;/webMaster^&gt;  &gt;&gt; %RSS%<br />REM конец головы<br /><br />for %%f in (%WORKDIR%\snapshots\*) do (<br /> echo ^  &gt;&gt; %RSS%<br /> echo ^%DATE%^&lt;/title^&gt;  &gt;&gt; %RSS%<br /> echo ^http://mathfqa.somee.com/rss.aspx^&lt;/link^&gt;  &gt;&gt; %RSS%<br /> echo ^^  &gt;&gt; %RSS%<br /><br /> sed s/^&gt;/New/g %%f | sed s/^&lt;/Deleted/g | sort -r &gt;&gt; %RSS%<br /><br /> echo ^&lt;/list^&gt;^&lt;/description^&gt;  &gt;&gt; %RSS%<br /> echo ^%DATE%^&lt;/pubDate^&gt;  &gt;&gt; %RSS%<br /> echo ^http://mathfqa.somee.com/rss.aspx^&lt;/guid^&gt;  &gt;&gt; %RSS%<br /> echo ^&lt;/item^&gt; &gt;&gt; %RSS%<br />)<br /><br />REM Хвост<br />echo ^&lt;/channel^&gt; &gt;&gt; %RSS%<br />echo ^&lt;/rss^&gt; &gt;&gt; %RSS%<br />REM конец хвоста<br /><br />del /Q %WORKDIR%\dir1<br />ren %WORKDIR%\dir2 dir1<br /></pre><br /><b>Thnx to</b> Evgenius за шаблон RSS, с нашего давно почившего сайта</div></div>