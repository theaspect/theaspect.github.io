---
layout: post
title: Про Git и Mercurial
date: '2014-10-25T00:40:00.001+07:00'
author: Constantine Linnick
tags:
- работа
- контроль версий
- development
modified_time: '2014-10-25T00:40:06.248+07:00'
thumbnail: http://2.bp.blogspot.com/-U7SKX0lpMKQ/VEnn1Nco_nI/AAAAAAAACrc/R1Fgv_RvvuM/s72-c/Screenshot%2B2014-10-24%2B09.46.29.png
blogger_id: tag:blogger.com,1999:blog-372595778394672936.post-4005360486976762885
blogger_orig_url: http://blog.blzr.me/2014/10/git-mercurial.html
---

<div dir="ltr" style="text-align: left;" trbidi="on"><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-U7SKX0lpMKQ/VEnn1Nco_nI/AAAAAAAACrc/R1Fgv_RvvuM/s1600/Screenshot%2B2014-10-24%2B09.46.29.png" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" src="http://2.bp.blogspot.com/-U7SKX0lpMKQ/VEnn1Nco_nI/AAAAAAAACrc/R1Fgv_RvvuM/s1600/Screenshot%2B2014-10-24%2B09.46.29.png" height="188" width="320" /></a></div>Моя борьба с git длится уже пятый год. Большую часть времени я его просто игнорировал. Последние пол года начал активно работать. Вообще, прекрасная иллюстрация <a href="http://en.wikipedia.org/wiki/Imprinting_(psychology)#Baby_duck_syndrome">импринтинга</a>:&nbsp;первой системой была svn, а затем произошел переезд на идейного наследника mercurial - после чего git кажется технологией пришельцев. Первые попытки были вынужденными: нужно было попатчить драйвер couchdb для диплома, заслать пару пуллреквестов - каждый раз приходилось открывать шпаргалку и копипастить команды в консоль. Не помогла даже книга <a href="http://blog.blzr.me/2012/11/pro-git.html">Pro Git</a>, пол года назад пролистал еще раз - пока читаешь - все понятно, но повторить не смог бы.<br /><br /><div class="separator" style="clear: both; text-align: left;"><a href="http://programmers.stackexchange.com/questions/212979/why-do-git-commits-not-contain-the-name-of-the-branch-they-were-created-on#answer-212998" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-YIWEugJjW8g/VEntb8UN4uI/AAAAAAAACrs/QAZQbsJ_2Gk/s1600/Screenshot%2B2014-10-24%2B10.10.42.png" height="280" width="640" /></a></div>Есть базовая идея, которая лежит в основе, без понимания которой все остальное не имеет смысла. В идеологии git есть один мастер бранч, все остальные - временные недоразумения, которые либо вливаются в главный, либо удаляются целиком, безымянные бранчи не могут существовать (хотя конечно есть reflog). В mercurial, как наследнике svn, бранчи - полноценные долгоживущие сущности, которие живут и после слияния. Поэтому граф git выглядит как корень дерева, а mercurial - как крона. Поэтому в git сложно взглянув на граф определить в каком бранче был сделан коммит, как он попал в текущую ветку и если ли эти изменения в ней вообще.<br /><br />Другая идея важная для понимания - в git, пока не был сделан merge или rebase, визуально четко разделяются чужие ветки и твои (branch-name vs origin/branch-name) поэтому fetch совершенно безопасен, поэтому push --force деструктивнее, но крайне удобен если понимаешь, что ты делаешь, в mercurial как только коммит попал к тебе, он становится твоим сразу же, поэтому hg strip приходится делать каждому разработчику. Интересно, что mercurial органично впитывает лучшие идеи git: strip, rebase, rebase -i, stash, backup copy при деструктивных операциях - обратного дрейфа не заметно.<br /><br />После того как освоил инструмент, обязательно начинаешь затачивать под свой workflow. Недавно, задействовав все свое bash-fu, родил монструозный алиас, чтобы понять в каком же бранче находится закрытый тикет (на самом деле главное - смерджен/не смерджен). Делать<br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">git log --grep</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">git branch --contain</span><br />быстро надоело, поэтому легко заменить на<br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">git gb #ISSUE-1234</span><br />при помощи<br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">gb = !git --no-pager log --format=\"%H\" --decorate --all --grep=$1 | xargs -I {} sh -c \"git branch --contains {}| paste -sd ',' - &amp;&amp; git --no-pager log --oneline --decorate {}^..{}\"</span><br /><h4 style="text-align: left;">ЗЫ</h4>Великолепный курс от <a href="https://www.codeschool.com/paths/git">codeschool</a><br />Интересная&nbsp;<a href="http://tonsky.me/blog/reinventing-git-interface/">статья</a> от tonsky<br />Мой <a href="http://blzr.me/to/gitconfig"><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">.gitconfig</span> </a></div>