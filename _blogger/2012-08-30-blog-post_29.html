---
layout: post
title: Как я мигрировал систему
date: '2012-08-30T03:32:00.000+07:00'
author: Constantine Linnick
tags:
- боль
- open source
modified_time: '2013-03-27T01:03:22.148+07:00'
thumbnail: http://2.bp.blogspot.com/-k9EvuXJJpZI/UD57ROa6pPI/AAAAAAAABkg/1SQaSvyP0jg/s72-c/%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA.PNG
blogger_id: tag:blogger.com,1999:blog-372595778394672936.post-2155452952387337451
blogger_orig_url: http://blog.blzr.me/2012/08/blog-post_29.html
---

<div dir="ltr" style="text-align: left;" trbidi="on">На десктопе семерка стояла на IDE, причем рядом имелся SATA жесткий диск с достаточным количеством свободного места. Неудавшаяся <a href="{{ site.baseurl }}{% post_url 2012-07-19-my-ssd-is-faster-then-your-hdd %}">миграция</a> никак не давала мне покоя, и вооружившись жестким диском для бекапа всего нажитого, я таки решил осуществить этот процесс.<br /><br /><a name='more'></a><br /><h3 style="text-align: left;">День первый </h3>Средство восстановления системы из образа показало свою полную несостоятельность при переносе системы без изменения разделов. Поэтому план был таков: уменьшить на SATA диске единственный раздел, а на его место вкорячить новый раздел, по размеру совпадающий с исходным системным диском. Для этого создал образ системы стандартными средствами - я всё еще не терял надежды на простой способ.<br /><br />Родная оснастка <i>diskmgmt.msc</i> не смогла уменьшить размер раздела на достаточную величину, даже после дефрагментации, и ругнулась на неперемещаемые файлы. На вооружении у меня была флешка с <a href="http://gparted.sourceforge.net/">gparted</a>: при помощи неё я уменьшил диск на необходимую величину и создал второй основной раздел. После этого, я загрузился в WinRE и попытался развернуть образ на другой диск: среда нужный раздел просто не видела и предлагала работать целиком с дисками.<br /><br /><div class="r" style="text-align: left;"><a href="http://criticsmaylie.files.wordpress.com/2012/05/nooooo.jpg" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" height="320" src="http://criticsmaylie.files.wordpress.com/2012/05/nooooo.jpg" width="202" /></a>Пришлось качать старую добрую <a href="http://clonezilla.org/">clonezilla </a>и перемещать раздел с одновременным расширением до нужного размера. Здесь я, видимо, допустил первую стратегическую ошибку сняв стандартную галочку про груб в загрузочном секторе. Минут за десять образ системы копируется и комп перезагружается и я получаю <b><span style="color: black;">a disk read error occurred press ctrl+alt+del to restart</span></b><span style="color: black;">. Epic FAIL.</span></div><div class="r" style="text-align: left;"><br /></div><div class="r" style="text-align: left;"><span style="color: black;">Дальше идут шесть безрезультатных часов, за которые я узнал много нового про особенности MBR и команды консоли восстановления. Перепробовал все возможные варианты, но на любые попытки загрузиться получал неизм</span><span style="color: black;">енный <b>disk read error</b>. При этом диск был жив и из исходной системы читался без проблем.</span></div><h4 class="r" style="text-align: left;"><span style="color: black;">Основные утилиты</span></h4><div class="r" style="text-align: left;"><span style="color: black;"><a href="http://technet.microsoft.com/ru-ru/library/cc766465%28v=ws.10%29.aspx">diskpart </a>- более функциональная, консольная версия оснастки для управления дисками</span></div><div class="r" style="text-align: left;"><span style="color: black;"><a href="http://technet.microsoft.com/ru-ru/library/cc709667%28v=ws.10%29.aspx">bcdedit </a>- редактирование загрузочной конфигурации</span></div><div class="r" style="text-align: left;"><a href="http://technet.microsoft.com/ru-ru/library/dd744347%28v=ws.10%29.aspx"><span style="color: black;">bcdboot</span></a><span style="color: black;"> - создание системного раздела, пригодного для загрузки</span></div><div class="r" style="text-align: left;"><span style="color: black;"><a href="http://technet.microsoft.com/ru-ru/library/cc749177%28v=ws.10%29">bootsect </a>- создание MBR</span><br /><a href="http://technet.microsoft.com/en-us/library/bb490934.aspx">mountvol</a> - управление точками монтирования и просмотр GUID разделов</div><div class="r" style="text-align: left;"><span style="color: black;"></span></div><h3 style="text-align: left;">День второй</h3><div style="text-align: left;">После того, как проверил несколько вариантов, и совсем отчаявшись решил еще раз клонировать систему, пусть хоть с грубом. На этот раз система даже смогла загрузиться, хоть и ругнулась на неправильный раздел. Восстановление системы пофиксило эту проблему и система загрузилась. Правда увидел я лишь пустой экран и предупреждение о неактивированной версии. Порывшись в диспетчере задач, я выяснил, что профиль пользователя - временный, а сама система стартует с раздела F:. В консоли восстановления были правильные имена. Diskpart у активного раздела, очевидно, метку тоже не мог поменять.</div><div style="text-align: left;"><br /></div><div style="text-align: left;">Тут я вспомнил, что для упрощения работы с метками, в реестпе сопоставляются GUID разделов и метка. Открыв в regedit ветку <b>HKLM/SYSTEM/MountedDevice</b>, я поменял местами нужные разделы и перезагрузил систему. Все стартануло, а система повторно активировалась.</div><h3 style="text-align: left;">Мораль</h3><div style="text-align: left;">Красноглазие винде не чуждо. За пол часа систему можно было переустановить, либо не париться и жить на IDE. Но так не хотелось терять статистику:</div><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-k9EvuXJJpZI/UD57ROa6pPI/AAAAAAAABkg/1SQaSvyP0jg/s1600/%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="94" src="http://2.bp.blogspot.com/-k9EvuXJJpZI/UD57ROa6pPI/AAAAAAAABkg/1SQaSvyP0jg/s320/%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA.PNG" width="320" /></a></div><div style="text-align: left;"><br /></div></div>